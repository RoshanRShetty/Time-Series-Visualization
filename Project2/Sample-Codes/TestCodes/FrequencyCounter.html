<!DOCTYPE html>
<html lang="en">
	<head>
		<title> Word Frequency Counter </title>
		<script type="text/javascript" src="https://d3js.org/d3.v3.min.js"> </script>
		<script src="https://d3js.org/d3-dsv.v1.min.js"></script>
	</head>
	<body>

		<script type="text/javascript">

			// Initializing Global Variables to be used in the program
			var allData;
			// allLocation Format : {nameOfLocation: total frequency}, similar for allPersons, allOrganization and allMiss
			var allLocations = new Map();
			var allPersons = new Map();
			var allOrganization = new Map();
			var allMiss	= new Map();





			var locationValues =[];

			

			var date;
			var location;
			var people;
			var category;
			var missc;
			var parseLocation;
			var modYear = 2004;

			
			//Initializing time and date parsers for handling date.
			parseDate = d3.time.format("%Y-%m").parse;
			formatDate = d3.time.format("%b-%Y");

			
			

			

			

			//Loading the wikinews data file and processing it
			d3.tsv("../Data/wikinews.tsv", function(error,data)
			{
				allData = data
				if (error) throw error;

				data.forEach(function(d){

					
					processName(d);
					processLocation(d);
					processOrganization(d);
					processMiss(d);

					

					

				})

			}) // end of d3.tsv



			//function for processing all locations
			function processLocation(d)
			{

				parseLocation = d.location.replace("\"","").split("|");

				parseLocation.forEach(function(eachLocation)
				{

					var isLocationPresent = getMapValue(allLocations,eachLocation)


					if (isLocationPresent === undefined)
					{
						allLocations[eachLocation] = {"Total":1, "monthlyFrequency": []}

						processMonthlyFrequency(allLocations,eachLocation,d.time)
						
					}
					else
					{
						allLocations[eachLocation].Total = allLocations[eachLocation].Total + 1
						processMonthlyFrequency(allLocations,eachLocation,d.time)
					}



				})
			}


			function processName(d)
			{
				parseName = d.person.replace("\"","").split("|");

				parseName.forEach(function(eachPerson){

					var isPersonPresent = getMapValue(allPersons,eachPerson)

					if (isPersonPresent === undefined)
					{
						allPersons[eachPerson] = {"Total":1, "monthlyFrequency": []}
						processMonthlyFrequency(allPersons,eachPerson,d.time)
							
					}
					else
					{
						allPersons[eachPerson].Total = allPersons[eachPerson].Total + 1
						processMonthlyFrequency(allPersons,eachPerson,d.time)
					}

				})
			}


			function processOrganization(d)
			{

				parseOrganization = d.organization.replace("\"","").split("|");

				parseOrganization.forEach(function(eachOrganization)
				{

					var isOrganizationPresent = getMapValue(allOrganization,eachOrganization)

					if (isOrganizationPresent === undefined)
					{
						console.log(eachOrganization + "here")
						allOrganization[eachOrganization] = {"Total":1, "monthlyFrequency": []}
						processMonthlyFrequency(allOrganization,eachOrganization,d.time)
							
					}
					else
					{
						console.log(eachOrganization + "here2")
						allOrganization[eachOrganization].Total = allOrganization[eachOrganization].Total + 1
						processMonthlyFrequency(allOrganization,eachOrganization,d.time)
					}

				})
			}


			function processMiss(d)
			{
				parseMiss = d.miscellaneous.replace("\"","").split("|");

				parseMiss.forEach(function(eachMiss)
				{

					var isMissPresent = getMapValue(allMiss,eachMiss)

					if (isMissPresent === undefined)
					{
						allMiss[eachMiss] = {"Total":1, "monthlyFrequency": []}
						processMonthlyFrequency(allMiss,eachMiss,d.time)
						
					}
					else
					{
						allMiss[eachMiss].Total = allMiss[eachMiss].Total + 1
						processMonthlyFrequency(allMiss,eachMiss,d.time)
					}

				})



			}



				

				

				


			




			function getMapValue(theMap,theValue)
			{			
				
				return theMap[theValue]


			}


			function processMonthlyFrequency(theMap,theValue,theTime)
			{

				var year = theTime.substring(0,4);
				var month = theTime.substring(5,7);


				//console.log(year + " " + month)

				var arrayIndex = ( ( (year % modYear) * 12) - 10 ) + (month - 1)

				//console.log(arrayIndex);



				var arrayValue = theMap[theValue].monthlyFrequency

				if ( arrayValue[arrayIndex] === undefined )
				{
					arrayValue[arrayIndex] = 1;

				}
				else
				{
					arrayValue[arrayIndex] = arrayValue[arrayIndex] + 1;

				}



			}



			
		

			





		</script>
	</body>
</html>