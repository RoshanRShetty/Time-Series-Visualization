<!DOCTYPE html>
<html>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="d3.layout.cloud.js"></script>
<head>
    <title>Word Cloud Example</title>
</head>
<style>
    body {
        font-family:"Lucida Grande","Droid Sans",Arial,Helvetica,sans-serif;
    }
    .legend {
        border: 1px solid #555555;
        border-radius: 5px 5px 5px 5px;
        font-size: 0.8em;
        margin: 10px;
        padding: 8px;
        width: 20%;
    }
    .bld {
        font-weight: bold;
    }

    div.tooltip {
        position: absolute;
        text-align: center;
        padding: 5px;
        font: 12px sans-serif;
        background: black;
        color: white;
        border: 1px;
        border-radius: 4px;
        pointer-events: none;
    }

</style>
<body>
<div>
    <div class="legend">
        Commonly used words are larger and slightly faded in color.  Less common words are smaller and darker.<br><br>
        <button onclick="callFile('allPersons.csv')">Add Persons</button><br>
        <button onclick="callFile('allLocations.csv')">Add Location</button><br>
        <button onclick="callFile('allOrganization.csv')">Add Organization</button><br>
        <button onclick="callFile('allMiss.csv')">Add Miscellaneous</button>
    </div>
</div>
</body>
<script>



/*General Comments

    1. Any element that has an 'id' attribute cannot have a value with a space in it. E.g. someElement.attr("id", "North Dakota")
        such id's with spaces in them wont get recognized. so to handle this, we are using the String.split(" ").join("_")
        This will convert 'North Dakota' to 'North_Dakota' 

*/
    var div = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);


    //initializing the wordList array
    var wordList =  [],
                    width = 1600,
                    height = 800;


    var thisArg;
    //initializing a scale to scale the frequencies of the words

    //initializing variables to set the scale
    var maxSize;
    var minSize;

    //var for svg ids

    var svgIDs;


    //initializing allData to hold contents of csv file
    function callFile(passedArg) {
        thisArg=passedArg;
        svgIDs = passedArg.replace(".csv","");
        wordList.splice(0);

        d3.selectAll(".wordcloud").remove();

        d3.csv(passedArg, function (error, data) {

            //Logic to get scale of the words

            allData = data;

            // maxSize = d3.max(allData,function(d){
            //     return d.total
            // })

            // minSize = d3.min(allData,function(d){
            //     console.log(d.total)
            //     return d.total
            // })


            var wordSizeScale = d3.scale.linear()
                    .domain([d3.min(data, function(d) {
                        return d.total;
                    }), d3.max(data, function(d) {
                        return d.total*2.5;
                    })])
                    .range([10,100]);

            for(var i=0;i<50;i++){
                wordList.push({"text": allData[i].text, "size": allData[i].total});
                console.log(allData[i].total);
            }


            d3.layout.cloud().size([800, 300])
                    .words(wordList.map(function (d) {
                        return {text: d.text, size: d.size}; // the wordlist.map is important else, the code for wordle wont work
                    }))
                    .rotate(0)
                    .fontSize(function (d) {
                        return wordSizeScale(d.size);
                    })
                    .on("end", draw)
                    .start();


        });
    }



    var color = d3.scale.linear()
            .domain([1,2,3,4,5,6,10,15,20,100])
            .range(["#ddd", "#ccc", "#bbb", "#aaa", "#999", "#888", "#777", "#666", "#555", "#444", "#333", "#222"]);

    

    function draw(words) {

        d3.select("body")
                .append("svg")
                .attr("id", svgIDs)
                    .attr("width", 900)
                    .attr("height", 400)
                     .attr("class", "wordcloud")
                .append("g")    
                // without the transform, words words would get cutoff to the left and top, they would
                // appear outside of the SVG area
                    .attr("transform", "translate(320,200)")
                    .selectAll("text")
                    .data(words)
                    .enter()
                    .append("text")
                        .attr("class","wordle")
                        .attr("id", function(d){return (d.text.split(" ").join("_") + "_wordle");}) // this step is to assign unique id's to each word
                        .style("font-size", function(d) { return d.size + "px"; })
                        .style("fill", function(d, i) { return color(i); })
                        .attr("transform", function(d) {
                            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                        })
                        .text(function(d) { return d.text; })
                        .on("mouseover", function(d){
                            div.transition()
                                    .style("opacity", 1);
                            div.html("<u><span>" + d.text + "</span></u><br>" +
                                    "frequency: <span>" + d.size + "</span>")
                                    .style("left", (d3.event.pageX+30) + "px")
                                    .style("top", (d3.event.pageY - 28) + "px");
                            var wordID = d3.select(this).attr("id");
                            d3.selectAll(".wordle").style("opacity",0.2);
                            d3.select("#" + wordID).style("opacity",1);
                        })
                        .on("mouseout", function(d) {
                            div.transition()
                                    .style("opacity", 0);
                            d3.selectAll(".wordle").style("opacity",1);
                        })
    }

</script>

</html>